{"version":3,"sources":["index.js"],"names":["allCurrencies","dotNumberKey","minNum","maxNum","defaultNum","currency","document","querySelector","usedCurrenciesKey","inputEl","getBtn","clearBtn","resEl","fromEl","toEl","burger","reverse","saveDefaultBtn","defaultFrom","defaultTo","saveDotBtn","dotNumberInput","addCurrencySelect","saveAddCurrencyBtn","setInitialCurrenciesBtn","isFromAttr","isToAttr","apiGetAll","apiGetValue","initialUsedCurrencies","id","currencyName","name","initialize","initNotification","initListeners","setCurrenciesSelectors","setDefaultDot","setAllCurrencies","Notification","requestPermission","status","console","log","addEventListener","getCurrency","clear","toggleMenu","toggleCurrency","saveDefaultHandler","saveDotNumber","saveAddCurrency","setInitialCurrencies","clearSelectors","setSelectors","innerHTML","data","getData","appendChild","getMountedOptions","selectPosition","isShort","fromVal","value","toVal","query","getQuery","fetch","then","resp","json","rate","item","val","navigator","onLine","displayNotification","calculate","catch","err","innerText","num","Number","numDotStored","numDot","Math","round","pow","focus","activeClass","body","classList","contains","remove","add","firstIndex","selectedIndex","secondIndex","selected","itemFrom","itemTo","text","permission","serviceWorker","getRegistration","reg","showNotification","firstValue","secondValue","forEach","saveData","key","localStorage","setItem","JSON","stringify","getItem","parse","res","mountAllCurrencies","results","mountedOptions","filterAlreadyExist","usedCurrencies","Object","keys","filter","length","settings","options","map","createOption","sort","a","b","dataset","wrapper","createDocumentFragment","el","createElement","newCurrency","newCurrencies","push"],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["const dotNumberKey = 'dotNumber';\nconst minNum = 0;\nconst maxNum = 5;\nconst defaultNum = 2;\nconst currency = document.querySelector('.currency');\nconst usedCurrenciesKey = 'usedCurrency';\nconst inputEl = currency.querySelector('.input');\nconst getBtn = currency.querySelector('.get');\nconst clearBtn = currency.querySelector('.clear');\nconst resEl = currency.querySelector('.result');\nconst fromEl = currency.querySelector('.select-from');\nconst toEl = currency.querySelector('.select-to');\nconst burger = currency.querySelector('.menu');\nconst reverse = currency.querySelector('.reverse');\nconst saveDefaultBtn = currency.querySelector('.save-default');\nconst defaultFrom = currency.querySelector('.default-from');\nconst defaultTo = currency.querySelector('.default-to');\nconst saveDotBtn = currency.querySelector('.save-dot-number');\nconst dotNumberInput = currency.querySelector('.dot-number');\nconst addCurrencySelect = currency.querySelector('.add-currency-select');\nconst saveAddCurrencyBtn = currency.querySelector('.save-add-currency');\nconst setInitialCurrenciesBtn = currency.querySelector('.set-initial-btn');\nconst isFromAttr = 'isFrom';\nconst isToAttr = 'isTo';\nconst apiGetAll = 'https://free.currencyconverterapi.com/api/v6/currencies';\nconst apiGetValue = 'https://free.currencyconverterapi.com/api/v5/convert';\nconst initialUsedCurrencies = [\n\t{id: 'PLN', currencyName: 'Polish Zloty', name: 'Polish Zloty', [isFromAttr]:true},\n\t{id: 'EUR', currencyName: 'Euro', name: 'Euro'},\n\t{id: 'USD', currencyName: 'United States Dollar', name: 'United States Dollar'},\n\t{id: 'UAH', currencyName: 'Ukrainian Hryvnia', name: 'Ukrainian Hryvnia', [isToAttr]:true},\n\t{id: 'RUB', currencyName: 'Russian Ruble', name: 'Russian Ruble'}\n]\nlet allCurrencies;\n\ninitialize();\n\nfunction initialize() {\n\tinitNotification();\n\tinitListeners();\n\tsetCurrenciesSelectors();\n\tsetDefaultDot();\n\tsetAllCurrencies();\n};\n\nfunction initNotification() {\n\tif (typeof(Notification) === 'undefined') {\n\t\treturn;\n\t}\n\tNotification.requestPermission(function(status) {\n\t\tconsole.log('Notification permission status:', status);\n\t});\n}\n\nfunction initListeners() {\n\tgetBtn.addEventListener('click', getCurrency);\n\tclearBtn.addEventListener('click', clear);\n\tburger.addEventListener('click', toggleMenu);\n\treverse.addEventListener('click', toggleCurrency);\n\tsaveDefaultBtn.addEventListener('click', saveDefaultHandler);\n\tsaveDotBtn.addEventListener('click', saveDotNumber);\n\tsaveAddCurrencyBtn.addEventListener('click', saveAddCurrency);\n\tsetInitialCurrenciesBtn.addEventListener('click', setInitialCurrencies);\n}\n\nfunction setCurrenciesSelectors() {\n\tclearSelectors();\n\tsetSelectors();\n}\n\nfunction clearSelectors() {\n\tfromEl.innerHTML = '';\n\ttoEl.innerHTML = '';\n\tdefaultFrom.innerHTML = '';\n\tdefaultTo.innerHTML = '';\n}\n\nfunction setSelectors() {\n\tconst data = getData(usedCurrenciesKey) || initialUsedCurrencies;\n\n\tfromEl.appendChild(getMountedOptions(data, {selectPosition: isFromAttr, isShort: true}));\n\ttoEl.appendChild(getMountedOptions(data, {selectPosition: isToAttr, isShort: true}));\n\tdefaultFrom.appendChild(getMountedOptions(data, {selectPosition: isFromAttr, isShort: true}));\n\tdefaultTo.appendChild(getMountedOptions(data, {selectPosition: isToAttr, isShort: true}));\n}\n\nfunction getCurrency() {\n\tconst fromVal = fromEl.value;\n\tconst toVal = toEl.value;\n\tconst query = getQuery(fromVal, toVal);\n\n\tif (fromVal === toVal) {\n\t\tcalculate(1);\n\t\treturn;\n\t}\n\n\tfetch(query)\n\t\t.then(resp => {return resp.json()})\n\t\t.then(data => {\n\t\t\tlet rate = 1;\n\n\t\t\tfor (let item in data) {\n\t\t\t\trate = data[item].val;\n\t\t\t}\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tdisplayNotification('Application works offline');\n\t\t\t}\n\t\t\tcalculate(rate);\n\t\t})\n\t\t.catch(err => resEl.innerText = `Some problems with request - ${err}`);\n}\n\nfunction calculate(rate) {\n\tconst num = Number(inputEl.value);\n\tconst numDotStored = getData(dotNumberKey);\n\tconst numDot = numDotStored !== null ? numDotStored : defaultNum;\n\n\tresEl.innerText = Math.round(rate * num * Math.pow(10, numDot)) / Math.pow(10, numDot);\n}\n\nfunction clear() {\n\tinputEl.value = '';\n\tresEl.innerText = '';\n\tinputEl.focus();\n}\n\nfunction toggleMenu() {\n\tconst activeClass = '_burger-active';\n\tconst body = document.body;\n\n\tif (body.classList.contains(activeClass)) {\n\t\tbody.classList.remove(activeClass);\n\t} else {\n\t\tbody.classList.add(activeClass);\n\t}\n}\n\nfunction toggleCurrency() {\n\tconst firstIndex = fromEl.selectedIndex;\n\tconst secondIndex = toEl.selectedIndex;\n\n\tfromEl[secondIndex].selected = true;\n\ttoEl[firstIndex].selected = true;\n}\n\nfunction getQuery(itemFrom, itemTo) {\n\treturn `${apiGetValue}?q=${itemFrom}_${itemTo}&compact=y`;\n}\n\nfunction displayNotification(text) {\n    if (Notification.permission == 'granted') {\n        navigator.serviceWorker.getRegistration().then(function(reg) {\n            reg.showNotification(text);\n        });\n    }\n}\n\nfunction saveDefaultHandler() {\n\tconst firstValue = defaultFrom[defaultFrom.selectedIndex].id;\n\tconst secondValue = defaultTo[defaultTo.selectedIndex].id;\n\tconst data = getData(usedCurrenciesKey) || initialUsedCurrencies;\n\n\tdata.forEach(item => {\n\t\tconst id = item.id\n\n\t\titem[isFromAttr] = false;\n\t\titem[isToAttr] = false;\n\n\t\tif (id === firstValue) {\n\t\t\titem[isFromAttr] = true;\n\t\t}\n\n\t\tif (id === secondValue) {\n\t\t\titem[isToAttr] = true;\n\t\t}\n\t});\n\tsaveData(usedCurrenciesKey, data);\n\tsetCurrenciesSelectors();\n\ttoggleMenu();\n}\n\nfunction saveData(key, value) {\n\tlocalStorage.setItem(key, JSON.stringify(value));\n}\n\nfunction getData(key) {\n\tconst data = localStorage.getItem(key);\n\n\treturn JSON.parse(data);\n}\n\nfunction setDefaultDot() {\n\tconst data = getData(dotNumberKey);\n\n\tdotNumberInput.value = data !== null ? data : defaultNum;\n}\n\nfunction saveDotNumber() {\n\tconst value = Number(dotNumberInput.value);\n\tconst num = (value < minNum || value > maxNum) ? defaultNum : value;\n\n\tsaveData(dotNumberKey, num);\n\ttoggleMenu();\n}\n\nfunction setAllCurrencies() {\n\tfetch(apiGetAll)\n\t\t.then(res => res.json())\n\t\t.then(data => {\n\t\t\tallCurrencies = data.results;\n\t\t\tmountAllCurrencies(allCurrencies);\n\t\t})\n}\n\nfunction mountAllCurrencies(data=allCurrencies) {\n\tconst filteredData = filterAlreadyExist(data);\n\tconst mountedOptions = getMountedOptions(filteredData);\n\n\taddCurrencySelect.innerHTML = '';\n\taddCurrencySelect.appendChild(mountedOptions);\n}\n\nfunction filterAlreadyExist(data) {\n\tconst usedCurrencies = getData(usedCurrenciesKey) || initialUsedCurrencies;\n\tconst res = {};\n\n\tObject.keys(data).forEach(item => {\n\t\tconst id = data[item].id;\n\t\tif (usedCurrencies.filter(currency => currency.id === item).length === 0) {\n\t\t\tres[id] = data[id];\n\t\t}\n\t});\n\n\treturn res;\n}\n\nfunction getMountedOptions(data, settings) {\n\tconst options = Object.keys(data)\n\t\t.map(item => createOption(data[item], settings))\n\t\t.sort((a,b) => a.dataset.name < b.dataset.name ? -1 : 1);\n\tconst wrapper = document.createDocumentFragment();\n\n\toptions.forEach(item => wrapper.appendChild(item));\n\n\treturn wrapper;\n}\n\nfunction createOption(item, settings={}) {\n\tconst el = document.createElement('option');\n\n\tel.value = item.id;\n\tel.id = item.id;\n\tel.dataset.name = item.currencyName;\n\n\tif (settings.isShort) {\n\t\tel.innerText = item.id;\n\t} else {\n\t\tel.innerText = `${item.currencyName} (${item.id})`;\n\t}\n\n\tif (item[settings.selectPosition]) {\n\t\tel.selected = true;\n\t} else {\n\t\tel.selected = false;\n\t}\n\n\treturn el;\n}\n\nfunction saveAddCurrency() {\n\tconst usedCurrencies = getData(usedCurrenciesKey) || initialUsedCurrencies;\n\tconst newCurrency = addCurrencySelect[addCurrencySelect.selectedIndex];\n\tconst newCurrencies = [...usedCurrencies];\n\n\tnewCurrencies.push({\n\t\tid: newCurrency.id,\n\t\tcurrencyName: newCurrency.innerText\n\t})\n\n\tsaveData(usedCurrenciesKey, newCurrencies);\n\tsetCurrenciesSelectors();\n\tmountAllCurrencies();\n\ttoggleMenu();\n}\n\nfunction setInitialCurrencies() {\n\tsaveData(usedCurrenciesKey, null);\n\tmountAllCurrencies();\n\tsetCurrenciesSelectors();\n\ttoggleMenu();\n}"]}